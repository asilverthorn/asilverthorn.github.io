(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[150],{4150:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return k}});var r=n(7458),a=n(5106),i=n.n(a),l=n(1903),s=n(87),c=n(6191),o=n(516),u=n(3412),d=n.n(u),f=n(8936),h=n.n(f),m=n(3490),p=n(2983),x=n(2826),g=n(5810),v=n(9449);let b=[".smc",".sfc"];var j=n(340),y=n(7918);let w=e=>{let{className:t,...n}=e,a=(0,m.useRouter)(),i=(0,p.useRef)(null),[l,s]=(0,p.useState)(null),[u,f]=(0,p.useState)(null),[w,N]=(0,p.useState)(null),[C,k]=(0,p.useState)(""),[S,z]=(0,p.useState)(null),[F,R]=(0,p.useState)(!1),E=Boolean(u),{error:M,trigger:_,isMutating:U}=(0,g.Z)(["/api/music/generate",u],async(e,t)=>{let{arg:n}=t,r=await fetch("/api/music/generate",{headers:{},method:"POST",body:JSON.stringify({key:"ff6wc"})});if(200!==r.status){let a=await r.text();throw Error("Error randomizing music: ".concat(a))}let i=await r.json();return i}),O=async()=>{if(U||!u||!w||!l)return;let e=await _();if(!e)throw Error("There was an error randomizing the music");let{filename:t,patch:n,seed_id:r,log:i}=e,s=y.a.decode((0,j.X)(n),(0,j.X)(u));w.file(l,s,{binary:!0}),w.file("".concat(t,".txt"),i),w.generateAsync({type:"blob"}).then(e=>{W();var n=document.createElement("a");n.href=window.URL.createObjectURL(e),n.download="".concat(t,".zip"),n.click(),a.push("/music/seed/".concat(r))})},W=()=>{N(null),k(""),f(null),R(!1),z(null)},P=e=>{z(null);let t=h()(e.target.files),n=new FileReader;t&&(n.onload=async function(){let e=new Uint8Array(n.result),r="",a=e.byteLength;for(let i=0;i<a;i++)r+=String.fromCharCode(e[i]);r=btoa(r);let l=new(d()),c=await l.loadAsync(e),o=Object.values(c.files).find(e=>{let{name:t}=e;return b.some(e=>t.endsWith(e))});if(!o){z("Invalid file - No file ending in .smc or .sfc was found in the zip");return}let u=await o.async("base64");Object.values(c.files).filter(e=>{let{name:t}=e;return t!==(null==o?void 0:o.name)});try{c.remove(o.name),N(c),f(u),s(o.name),k(t.name),R(!0)}catch(h){z(null==h?void 0:h.message)}},n.readAsArrayBuffer(t))};return(0,r.jsxs)(c.Zb,{...n,contentClassName:(0,o.cx)("p-0 gap-3",t),title:(0,r.jsxs)(r.Fragment,{children:["Randomize music using"," ",(0,r.jsx)(c.rU,{href:"https://github.com/emberling/johnnydmad",children:"johnnydmad"})]}),children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(v.L,{emphasis:!0,variant:"danger",children:"Randomizing music will significantly modify load speeds"}),(0,r.jsxs)("h2",{className:"font-medium text-lg",children:["Step 1:"," ",(0,r.jsx)("span",{className:"",children:(0,r.jsx)(c.rU,{href:"/",children:"Generate an FF6WC zip file"})})]})]}),(0,r.jsx)("div",{className:"flex flex-col gap-2",children:(0,r.jsx)("h2",{className:"font-medium text-lg",children:"Step 2: Upload the created zip"})}),(0,r.jsxs)("div",{className:"flex min-h-[30px] gap-1 pl-3",children:[(0,r.jsxs)(c.zx,{className:"flex items-center gap-1",disabled:E,onClick:()=>{var e;return null===(e=i.current)||void 0===e?void 0:e.click()},variant:"outline",children:[(0,r.jsx)(x.s_P,{className:"inline"})," Upload FF6WC zip file.."]}),(0,r.jsx)(c.II,{disabled:!0,ref:i,placeholder:"Upload ROM to continue",onChange:()=>{},value:C}),(0,r.jsxs)(c.zx,{className:"flex items-center gap-1",disabled:!E,onClick:W,variant:"outline",children:[(0,r.jsx)(x.lUB,{className:"inline"})," Clear upload"]}),(0,r.jsx)("input",{accept:".zip",className:"hidden",id:"rom_name",ref:i,name:"rom",onChange:P,type:"file"})]}),(0,r.jsxs)("div",{className:"pl-3",children:[!F&&!S&&(0,r.jsx)("div",{className:"text-yellow-500 font-semibold",children:"Waiting for upload"}),F&&(0,r.jsx)("div",{className:"text-green-500 font-semibold",children:"Valid upload"}),S?(0,r.jsx)("div",{className:"text-red-500 font-semibold",children:S}):null]}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("h2",{className:"font-medium text-lg",children:"Step 3: Click Generate!"}),E?null:(0,r.jsx)(c.p6,{children:"Please upload a valid FF6WC zip above to continue"})]}),(0,r.jsxs)("div",{className:"fle flex-col gap-2 pl-3",children:[(0,r.jsx)(c.zx,{disabled:!E||U,onClick:O,variant:"primary",children:"Generate"}),M?(0,r.jsx)("div",{className:"text-red-500 font-semibold",children:M}):null," "]})]})};var N=n(8425);let C=()=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(i(),{children:[(0,r.jsx)("title",{children:"FF6WC Music Randomizer"}),(0,r.jsx)("meta",{name:"description",content:"Randomize the music in your FF6WC seed!"}),(0,r.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,r.jsx)(N.t,{}),(0,r.jsx)("div",{className:"flex-grow p-8 dark:bg-slate-800",children:(0,r.jsx)(l.x,{children:(0,r.jsx)(w,{})})}),(0,r.jsx)(s.So,{})]});var k=C},3490:function(e,t,n){e.exports=n(5972)},5810:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var r=n(2983),a=n(7371),i=n(338);function l(e,t,n,r,a,i,l){try{var s=e[i](l),c=s.value}catch(o){n(o);return}s.done?t(c):Promise.resolve(c).then(r,a)}var s=function(e,t){var n,r,a,i,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,r=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(a=(a=l.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){l.label=i[1];break}if(6===i[0]&&l.label<a[1]){l.label=a[1],a=i;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(i);break}a[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(s){i=[6,s],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},c=(0,i.xD)(a.ZP,function(){return function(e,t,n){void 0===n&&(n={});var c,o=(0,a.kY)().mutate,u=(0,r.useRef)(e),d=(0,r.useRef)(0),f=(0,i.Iy)({data:i.i_,error:i.i_,isMutating:!1}),h=f[0],m=f[1],p=f[2],x=h.current,g=(0,r.useCallback)((c=function(e,r){var a,l,c,f,h,m,x,g,v,b,j,y;return s(this,function(s){switch(s.label){case 0:if(l=(a=(0,i.qC)(u.current))[0],c=a[1],!t)throw Error("Can’t trigger the mutation: missing fetcher.");if(!l)throw Error("Can’t trigger the mutation: key isn’t ready.");f=Object.assign(((h={}).populateCache=!1,h),n,r),m=(0,i.u3)(),d.current=m,p(((x={}).isMutating=!0,x)),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,o(l,t(c,((v={}).arg=e,v)),f)];case 2:return g=s.sent(),b={},d.current<=m&&(p((b.data=g,b.isMutating=!1,b.error=void 0,b)),null==f.onSuccess||f.onSuccess(g,l,f)),[2,g];case 3:if(j=s.sent(),y={},d.current<=m)throw p((y.error=j,y.isMutating=!1,y)),null==f.onError||f.onError(j,l,f),j;return[3,4];case 4:return[2]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var a=c.apply(e,t);function i(e){l(a,n,r,i,s,"next",e)}function s(e){l(a,n,r,i,s,"throw",e)}i(void 0)})}),[]),v=(0,r.useCallback)(function(){d.current=(0,i.u3)(),p({data:i.i_,error:i.i_,isMutating:!1})},[]);return(0,i.LI)(function(){u.current=e}),{trigger:g,reset:v,get data(){return m.data=!0,x.data},get error(){return m.error=!0,x.error},get isMutating(){return m.isMutating=!0,x.isMutating}}}})}}]);